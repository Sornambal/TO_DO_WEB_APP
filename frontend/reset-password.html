<!DOCTYPE html>
<html>
<head>
  <title>Reset Password</title>
</head>
<body style="
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(to right, #e0f7fa, #f8f9fa);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
">

  <div style="
    background-color: #ffffff;
    padding: 35px 30px;
    border-radius: 15px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    width: 320px;
    text-align: center;
  ">
    <h2 style="margin-bottom: 25px; color: #2c3e50;">ðŸ”‘ Reset Password</h2>
    
    <form id="resetPasswordForm">
      <input type="password" name="newPassword" placeholder="New Password" required
        style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 8px; font-size: 15px;">
      
      <input type="password" name="confirmPassword" placeholder="Confirm New Password" required
        style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 8px; font-size: 15px;">
      
      <button type="submit"
        style="width: 100%; padding: 12px; background-color: #27ae60; color: white; font-size: 16px; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.3s;">
        Reset Password
      </button>
    </form>

    <p style="margin-top: 18px; font-size: 14px; color: #555;">
      Remember your password?
      <a href="login.html" style="color: #2980b9; text-decoration: none;">Login here</a>
    </p>
  </div>

  <script>
    // Get reset token from URL parameters or localStorage
    const urlParams = new URLSearchParams(window.location.search);
    let resetToken = urlParams.get('token');
    
    if (!resetToken) {
      resetToken = localStorage.getItem('resetToken');
    }

    if (!resetToken) {
      alert("No reset token found. Please request a new password reset.");
      window.location.href = 'login.html';
    }

    document.getElementById("resetPasswordForm").onsubmit = async (e) => {
      e.preventDefault();
      const form = e.target;
      const newPassword = form.newPassword.value;
      const confirmPassword = form.confirmPassword.value;

      if (newPassword !== confirmPassword) {
        alert("Passwords do not match");
        return;
      }

      if (newPassword.length < 6) {
        alert("Password must be at least 6 characters long");
        return;
      }

      try {
        const res = await fetch('http://localhost:5000/api/auth/reset-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            resetToken: resetToken,
            newPassword: newPassword
          })
        });

        const data = await res.json();

        if (res.ok) {
          alert("Password reset successful! You can now login with your new password.");
          localStorage.removeItem('resetToken');
          window.location.href = 'login.html';
        } else {
          alert(data.message || "Error resetting password");
        }
      } catch (err) {
        alert("Error connecting to server");
      }
    };
  </script>

</body>
</html> 