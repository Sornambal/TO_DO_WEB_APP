<!DOCTYPE html>
<html>
<head>
  <title>Login</title>
</head>
<body style="
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(to right, #e0f7fa, #f8f9fa);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
">

  <div style="
    background-color: #ffffff;
    padding: 35px 30px;
    border-radius: 15px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    width: 320px;
    text-align: center;
  ">
    <h2 style="margin-bottom: 25px; color: #2c3e50;">üîê Login</h2>
    
    <form id="loginForm">
      <input type="email" name="email" placeholder="Email" required
        style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 8px; font-size: 15px;">
      
      <input type="password" name="password" placeholder="Password" required
        style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 8px; font-size: 15px;">
      
      <button type="submit"
        style="width: 100%; padding: 12px; background-color: #3498db; color: white; font-size: 16px; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.3s;">
        Login
      </button>
    </form>

    <p style="margin-top: 15px; font-size: 14px; color: #555;">
      <a href="#" id="forgotPasswordLink" style="color: #e74c3c; text-decoration: none;">Forgot Password?</a>
    </p>

    <p style="margin-top: 18px; font-size: 14px; color: #555;">
      Don't have an account?
      <a href="register.html" style="color: #2980b9; text-decoration: none;">Register here</a>
    </p>
  </div>

  <script>
    document.getElementById("loginForm").onsubmit = async (e) => {
      e.preventDefault();
      const form = e.target;

      const res = await fetch('http://localhost:5000/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email: form.email.value,
          password: form.password.value
        })
      });

      const data = await res.json();

      if (res.ok) {
        localStorage.setItem('token', data.token);
        location.href = 'dashboard.html';
      } else {
        alert(data.message || "Invalid credentials");
      }
    };

    document.getElementById("forgotPasswordLink").onclick = async (e) => {
      e.preventDefault();
      const email = document.querySelector('input[name="email"]').value;
      
      if (!email) {
        alert("Please enter your email address first");
        return;
      }

      try {
        const res = await fetch('http://localhost:5000/api/auth/forgot-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });

        const data = await res.json();

        if (res.ok) {
          // Store the reset token in localStorage for demo purposes
          // In production, this would be sent via email
          localStorage.setItem('resetToken', data.resetToken);
          alert(`Password reset link sent! For demo purposes, your reset token is: ${data.resetToken}`);
          
          // Redirect to reset password page
          window.location.href = `reset-password.html?token=${data.resetToken}`;
        } else {
          alert(data.message || "Error sending reset link");
        }
      } catch (err) {
        alert("Error connecting to server");
      }
    };
  </script>

</body>
</html>
